generator client {
  provider     = "prisma-client"
  output       = "../generated"
  moduleFormat = "esm"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EmailScan {
  id           String       @id @default(uuid())
  userId       String
  departmentId String
  emailSubject String
  emailSender  String
  detectedAt   DateTime     @default(now())
  isPhishing   Boolean
  detectedBy   String
  links        String[]
  user         User         @relation(fields: [userId], references: [id])
  department   Department   @relation(fields: [departmentId], references: [id])
  actions      UserAction[]
}

model UserAction {
  id           String     @id @default(uuid())
  userId       String
  departmentId String
  emailScanId  String
  actionType   String
  link         String?
  actionAt     DateTime   @default(now())
  user         User       @relation(fields: [userId], references: [id])
  department   Department @relation(fields: [departmentId], references: [id])
  emailScan    EmailScan  @relation(fields: [emailScanId], references: [id])
}

model Department {
  id      String       @id @default(uuid())
  name    String       @unique
  users   User[]       @relation("DepartmentUsers")
  scans   EmailScan[]
  actions UserAction[]
}
